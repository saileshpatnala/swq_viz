<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Semantic Web Search</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />
  
  <link rel="stylesheet" href="http://jqueryui.com/jquery-wp-content/themes/jqueryui.com/style.css">

  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" id="bootstrap-css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  
  <!-- <script src="src/jquery.viafauto.js"></script> -->
  
  <!-- <script src="src/jquery.viafauto.extended.js"></script> -->
  
  <style>
  .ui-autocomplete-loading {
    background: white url('images/ui-anim_basic_16x16.gif') right center no-repeat;
  }
  #search { width: 25em; }
  </style>
  
  <script>
    function log( message ) {
        $( "<div>" ).text( message ).prependTo( "#log" );
        $( "#log" ).scrollTop( 0 );
    }

    $(function() {

      $("#myViafId").viafautox( {
          select: function(event, ui){
              var item = ui.item;
              var message = "From First Search Box: " +item.id + " " + item.value + " (type: " + item.nametype +")";
              log(message);
              event.preventDefault();
              event.stopPropagation();
              $(this).val("");
          } 
      });

      $(".clear").click(function() { $(this).prev("input").val(""); });
  }); 
</script>

</head>
<body>
<h1>Semantic Web Search</h1>


<div class="ui-widget">
  <form action="http://localhost:8080/TripleDataProcessor/webapi/myresource" method="POST" target="_blank"> 
    <div class="row">
      <div class="col-xs-6 col-md-4">
        <div class="input-group">
          <input type="text" class="ui-widget-content" placeholder="Search" id="myViafId" name="input">
          <div class="input-group-btn">
            <button class="btn btn-primary" type="submit" value="Submit">
              <span class="glyphicon glyphicon-search"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="ui-widget">
Result:
<div id="log" style="height: 200px; width: 300px; overflow: auto;" class="ui-widget-content"></div>
</div>


<script type="text/javascript">
  $(function() {
    $("#myViafId").viafautox( {
        select: function(event, ui){
            var item = ui.item;
            // var message = "From First Search Box: " +item.id + " " + item.value + " (type: " + item.nametype +")";
            var message = item.id;
            log(message);
            event.preventDefault();
            event.stopPropagation();
            $(this).val("");
        } 
    });
  });
</script>

<script type="text/javascript">
  (function($) {

    $.widget("oclc.viafautox", $.ui.autocomplete, {
     options: {
   // select: function(event, ui) { alert("Selected!"); return this._super(event, ui); },
      source: function(request, response) {
          var term = $.trim(request.term); 
          var url  = "http://viaf.org/viaf/AutoSuggest?query=" + term;
          var me = this; 
          $.ajax({
              url: url,
              dataType: "jsonp",
              success: function(data) {
                  if (data.result) {
                      response( $.map( data.result, function(item) {
                          var retLbl = item.term + " [" + item.nametype + "]";
                          return {
                              label: retLbl,
                              value: item.term,
                              id: item.viafid,
                              nametype: item.nametype
                          }
                      }));
                  } else {
                      me._trigger('nomatch', null, {term: term});
                  }
              },
          });  // end of $.ajax()
      }},      // end of source:, options

      /*
       * Punt a few fundamental tasks to the parent class
       */
      _create: function() {
          return this._super();
      },
      _setOption: function( key, value ) {
          this._super( key, value );
      },
      _setOptions: function( options ) {
          this._super( options );
      }
    });
  })(jQuery);
</script>

<script type="text/javascript">
  (function($) {
    $.widget("oclc.viafautox", $.oclc.viafauto, {
      _setOptions: function( options  ) { this._super( options  ); },
      _setOption:  function(key, value) { this._super(key, value); },
      _create:     function(          ) {    return this._super(); },
      _init:       function() {
          var me = this;
          $(me.element).on("viafautoxchange", function(event, ui) {
              $(me.element).removeClass("ui-autocomplete-loading");
              if (! ui.item){
               // console.log("_triggering noselect"); console.log(event.currentTarget);
                  me._trigger("noselect", event, {});
              }
          });
      }
    });
  })(jQuery);
</script>

</body>
</html>

